# ì½”ë“œë ˆì´ ì—°ê³„ ê°€ì´ë“œ
>
> ê¸°ì¡´ì— êµ¬ì„±ëœ DevOps íŒŒì´í”„ë¼ì¸ì— `ì†ŒìŠ¤ì •ì ë¶„ì„ ë‹¨ê³„ ì¶”ê°€`í•˜ëŠ” ê²ƒì„ ì•ˆë‚´í•©ë‹ˆë‹¤.\
> ì°¸ê³ ë¡œ, `ì½”ë“œë ˆì´`ëŠ” SK AXì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” **ì†ŒìŠ¤ì •ì ë¶„ì„ë„êµ¬ ì†”ë£¨ì…˜**ì…ë‹ˆë‹¤.\
> ë³¸ ê°€ì´ë“œëŠ” DevOps íŒŒì´í”„ë¼ì¸ì— **ë‹¨ê³„ ì¶”ê°€**ì— ê´€í•œ ë¶€ë¶„ë§Œ ì•ˆë‚´í•˜ë©°\
> ì‹¤ì œ ì½”ë“œë ˆì´ ì‚¬ìš©ë²•ì€ ì •ë³´ë³´í˜¸íŒ€ì—ê²Œ ì—°ë½ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. \
> ë„ì»¤ì´ë¯¸ì§€ê²½ë¡œ: ghcr.io/skccmygit/coderay-openapi:latest

## ì‚¬ì „ ì¤€ë¹„ ì‘ì—…

- [X] **ì½”ë“œë ˆì´ ì ‘ì† ê³„ì •** (<https://coderay.skax.co.kr:28443>)
- [X] **ì½”ë“œë ˆì´ ê´€ë¦¬ í”„ë¡œì íŠ¸ ì½”ë“œ ì •ë³´**
- [X] **ì½”ë“œë ˆì´ ì—°ë™ê´€ë¦¬ ì¸ì¦ KEY**
- [X] **ì½”ë“œë ˆì´ Open API ACCESS ë° SECRET KEY**
- [X] **ë¹Œë“œì„œë²„ â†’ ì½”ë“œë ˆì´ ì„œë²„ ë°©í™”ë²½í•´ì œ**
- [X] **ì½”ë“œë ˆì´ì„œë²„ â†’ ì†ŒìŠ¤ì €ì¥ì†Œ ë°©í™”ë²½í•´ì œ**

â€» ì½”ë“œë ˆì´ ê³„ì • ë° í”„ë¡œì íŠ¸ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ì‹ ì²­ í•„ìš”

## ì½”ë“œë ˆì´ ì—°ë™ í”„ë¡œì„¸ìŠ¤

### 1. í˜•ìƒê´€ë¦¬ ì¸ì¦ KEY ë°œê¸‰ ë° ì ‘ì† í…ŒìŠ¤íŠ¸

- **ì½”ë“œë ˆì´ ì ‘ì†ë¡œê·¸ì¸ [https://coderay.skcc.com:28443](https://coderay.skcc.com:28443)**\
  ![ì½”ë“œë ˆì´ ë¡œê·¸ì¸](./images/coderay_0_login.png)
- **ìš°ì¸¡ìƒë‹¨ - ê´€ë¦¬ - ì—°ë™ê´€ë¦¬ í´ë¦­**\
  ![ì½”ë“œë ˆì´ ì—°ë™ê´€ë¦¬](./images/coderay_1_set_1.png)
- **ì—°ë™ê´€ë¦¬ - í˜•ìƒê´€ë¦¬ ì¸ì¦ ì •ë³´ í´ë¦­ â†’ ìš°ì¸¡ `+` í´ë¦­**\
  ![ì½”ë“œë ˆì´ ì—°ë™ê´€ë¦¬ ì¶”ê°€](./images/coderay_1_set_2.png)
- **ì¸ì¦ì´ë¦„, ì•„ì´ë””, í† í° ì…ë ¥**\
  ![ì¸ì¦ ì •ë³´ ì…ë ¥](./images/coderay_1_set_3.png)
- **ìƒì„±ëœ ì¸ì¦ì •ë³´ì˜ `ìƒˆë¡œê³ ì¹¨` í´ë¦­**\
  ![ìƒˆë¡œê³ ì¹¨ í´ë¦­](./images/coderay_2_con_test_1.png)
- **GIT ì ‘ì† URL ì…ë ¥ í›„ `ì ‘ì† í…ŒìŠ¤íŠ¸` í´ë¦­**\
  ![ì ‘ì†í…ŒìŠ¤íŠ¸ í´ë¦­](./images/coderay_2_con_test_2.png)
- **ì ‘ì† ì„±ê³µ ì‹œ, ì•„ë˜ì™€ ê°™ì€ ë©”ì‹œì§€ ì•ˆë‚´**\
  ![ì ‘ì† ì„±ê³µ](./images/coderay_2_con_test_3.png)\
- **í˜•ìƒê´€ë¦¬ ì¸ì¦ ì •ë³´ì˜ ë¬¸ìì—´ì€ `ì—°ë™ê´€ë¦¬ ì¸ì¦ KEY`ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.**\
  ![ìƒˆë¡œê³ ì¹¨ í´ë¦­](./images/coderay_2_con_test_4.png)

### 2. Open API ì ‘ì† KEY ë°œê¸‰

- **ìš°ì¸¡ìƒë‹¨ - ê´€ë¦¬ - ì—°ë™ê´€ë¦¬ í´ë¦­**\
  ![ì½”ë“œë ˆì´ ì—°ë™ê´€ë¦¬](./images/coderay_1_set_1.png)
- **ì—°ë™ê´€ë¦¬ - Open API í´ë¦­ â†’ ìš°ì¸¡ `+` í´ë¦­**\
  ![ì½”ë“œë ˆì´ ì—°ë™ê´€ë¦¬ API ì¶”ê°€](./images/openapi_set_1.png)
- **Open API ê¸°ëŠ¥(í˜•ìƒê´€ë¦¬ë¶„ì„, ë¶„ì„ìƒíƒœ, ë¶„ì„ê²°ê³¼) ì„ íƒ, ì„œë¹„ìŠ¤(ë¹Œë“œí”Œë«í¼) ì„ íƒ, ì½”ë“œë ˆì´ ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥í›„ í™•ì¸ ë²„íŠ¼ í´ë¦­**\
  ![OPEN API ìƒì„±](./images/openapi_set_2.png)
- **ìƒì„±ëœ ACCESS Key ë° SECRET Keyë¥¼ ì €ì¥**\
  ![ACCESS, SECRET KEY ì €ì¥](./images/openapi_set_3.png)

### 3. ì½”ë“œë ˆì´ í”„ë¡œì íŠ¸ ì½”ë“œ í™•ì¸

- **ì½”ë“œë ˆì´ í”„ë¡œì íŠ¸ ì½”ë“œ í™•ì¸**\
  ![í”„ë¡œì íŠ¸ ì½”ë“œ í™•ì¸](./images/openapi_set_4.png)

### 4. CICD íŒŒì´í”„ë¼ì¸ì— ì½”ë“œë ˆì´ ì—°ê³„ ë‹¨ê³„ ì¶”ê°€
>
> ê¸°ì¡´ ë¹Œë“œ ìŠ¤í…ì—ì„œ `ì½”ë“œë ˆì´ ì—°ê³„ ë‹¨ê³„ë§Œ ì¶”ê°€`í•©ë‹ˆë‹¤.\
> ì½”ë“œë ˆì´ ì—°ê³„ëŠ” Docker ê¸°ë°˜ìœ¼ë¡œ í˜¸ì¶œ í•©ë‹ˆë‹¤.\
> Docker í˜¸ì¶œ ì‹œ, `ë³€ìˆ˜ ë˜ëŠ” ì‹œí¬ë¦¿`ì€ ë¹Œë“œ í”Œë«í¼ ë‚´ì˜ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ë„ ë¬´ë°©í•©ë‹ˆë‹¤.\
> ë„ì»¤ì´ë¯¸ì§€ ì •ë³´: **ghcr.io/skccmygit/coderay-openapi:latest**
  
#### 2-1. GithubActions workflow
>
> ê¸°ì¡´ì˜ workflow.yml íŒŒì¼ ë‚´ìš©ì—ì„œ `Coderay ì—°ë™ ë¶€ë¶„`ë§Œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. \
> Github Actions variable ë° secretì„ ì´ìš©í•œ ì˜ˆì œì…ë‹ˆë‹¤. \
> workflow êµ¬ì„±ì€ ê° í”„ë¡œì íŠ¸ì— ë§ê²Œ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤. (Job ë˜ëŠ” Step êµ¬ì„±)

- ì•„ë˜ëŠ” Step êµ¬ì„±ìœ¼ë¡œ í˜¸ì¶œí•œ ìƒ˜í”Œ ì…ë‹ˆë‹¤. (ì²´í¬ì•„ì›ƒ-ë¹Œë“œ-ì½”ë“œë ˆì´ìŠ¤ìº”-ë°°í¬)

  ```yml
  jobs:
    build:
      runs-on:
        group: organization/Default
      steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Build
          run: |
            echo "===== Build Stage ====="
            echo "ë¹Œë“œ ìˆ˜í–‰"
        
        - name: Coderay Docker Image Pull
          run: docker pull ${{ vars.CODERAY_IMAGE_NAME }}
        - name: Coderay Scan
          run: |
            docker run --rm \
              --name coderay-open-api \
              -e SERVICE_NAME=${{ vars.SERVICE_NAME }} \
              -e ACCESS_KEY=${{ secrets.ACCESS_KEY }} \
              -e SECRET_KEY=${{ secrets.SECRET_KEY }} \
              -e PC_CODE=${{ vars.PC_CODE }} \
              -e ACC_CODE=${{ vars.ACC_CODE }} \
              -e SRC_URL=${{ github.server_url }}/${{ github.repository }} \
              -e REV=${{ github.event.inputs.environment || github.ref_name }} \
              ${{ vars.CODERAY_IMAGE_NAME }}

        - name: Deploy
          run: |
            echo "Deploy Stage"
            echo "ë°°í¬ ìˆ˜í–‰"
  ```

#### 2-2. Jenkins
>
> Jenkins íŒŒì´í”„ë¼ì¸ì—ì„œ `ì½”ë“œë ˆì´ ì—°ê³„ ë‹¨ê³„(stage)ë§Œ ì¶”ê°€` ì¶”ê°€ í•˜ì—¬ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
>

```groovy
pipeline {
  agent any

  stages {
    stage('Checkout') {
      steps {
        sh "echo ===== Checkout Stage ====="
        sh "echo ê° ì €ì¥ì†Œì—ì„œ ì²´í¬ì•„ì›ƒì„ ë°›ìŒ"
      }
    }

    stage('Build') {
      steps {
        sh "echo ===== Build Stage ====="
        sh "echo ê°ì €ì¥ì†Œì—ì„œ ì†ŒìŠ¤ ë¹Œë“œ"
      }
    }

    stage('SAST') {
      steps {
        script {
          int exitCode = sh(
            script: '''
              echo "===== SAST Scan (SUCCESS) ====="
              docker run --rm \
                --name coderay-open-api-success \
                -e SERVICE_NAME=<ì„œë¹„ìŠ¤ëª…> \
                -e ACCESS_KEY=<ì½”ë“œë ˆì´ ì ‘ê·¼í‚¤> \
                -e SECRET_KEY=<ì½”ë“œë ˆì´ ë¹„ë°€í‚¤> \
                -e PC_CODE=<ì½”ë“œë ˆì´ í”„ë¡œì íŠ¸ì½”ë“œ> \
                -e ACC_CODE=<ì½”ë“œë ˆì´ í˜•ìƒê´€ë¦¬ í‚¤> \
                -e SRC_URL=<ì €ì¥ì†Œ URL> \
                -e REV=<ë¶„ì„ëŒ€ìƒ ë¸Œëœì¹˜> \
                ghcr.io/skccmygit/coderay-openapi:latest
            ''',
            returnStatus: true
          )

          if (exitCode == 0) {
            echo "âœ… SAST PASS (Success Flow)"
            env.SAST_RESULT = "PASS"
          } else {
            echo "âš ï¸ SAST FAIL (exitCode=${exitCode}) - ë°°í¬ ë§‰ì„ ì˜ˆì •"
            env.SAST_RESULT = "FAIL"
          }
        }
      }
    }

    stage('Deploy') {
      when {
        expression { env.SAST_RESULT == "PASS" }
      }
      steps {
        sh "echo ===== Deploy Stage Success Flow ====="
        sh "echo ë°°í¬ ìˆ˜í–‰"
      }
    }
  }

  post {
    success { echo "ğŸ‰ Pipeline completed successfully!" }
    failure { echo "âŒ Pipeline failed" }
  }
}

```

### 5. ì½”ë“œë ˆì´ ì‚¬ì´íŠ¸ì—ì„œ ê²°ê³¼ í™•ì¸

- **ì½”ë“œë ˆì´ ê²°ê³¼í™•ì¸ (ì¢Œì¸¡ ë¶„ì„íšŒì°¨ë³„ ëª©ë¡ í´ë¦­í•˜ì—¬ í™•ì¸)**
  ![ì½”ë“œë ˆì´ ê²°ê³¼í™•ì¸](./images/coderay_result.png)

## ì°¸ê³ ì‚¬í•­

- í™˜ê²½ë³€ìˆ˜ ì„¤ëª…

  | í™˜ê²½ë³€ìˆ˜ëª…   | ì„¤ëª…                     |
  | --------- | ------------------------ |
  | ACCESS_KEY    | OpenAPI ìƒì„±ì‹œ ì·¨ë“í•œ Access Key                |
  | SECRET_KEY | OpenAPI ìƒì„±ì‹œ ì·¨ë“í•œ Secret Key            |
  | SERVICE_NAME     | OpenAPI ìƒì„±ì‹œ ì„ íƒí•œ ë¹Œë“œ í”Œë«í¼ëª… |
  | PC_CODE      | ì½”ë“œë ˆì´ í”„ë¡œì íŠ¸ ì½”ë“œ      |
  | ACC_CODE    | í˜•ìƒ ì¸ì¦ í‚¤        |
  | SRC_URL    | ì €ì¥ì†Œ URL        |
  | REV    | ìŠ¤ìº” ëŒ€ìƒ ë¸Œëœì¹˜ëª…        |

- ì½”ë“œë ˆì´ ìµœì´ˆ ì—°ë™ì‹œì—ëŠ” ë¶„ì„ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
  ìµœì´ˆ ì´í›„ ë¶„ì„ì˜ ê²½ìš° `ì¦ë¶„ëŒ€ìƒ`ë§Œ ìŠ¤ìº”í•©ë‹ˆë‹¤.
- **ìš´ì˜ íŒŒì´í”„ë¼ì¸**ì—ì„œëŠ” `SAST ë¶„ì„`ë‹¨ê³„ëŠ” ë°˜ë“œì‹œ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. \
  ê·¸ ì™¸ ë‹¨ê³„ì—ì„œëŠ” í”„ë¡œì íŠ¸ ë‚´ë¶€ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
- Docker ê¸°ë°˜ í˜¸ì¶œì´ ë¶ˆê°€ëŠ¥í•œ ìƒí™©ì—ì„œëŠ” `Jar íŒŒì¼` ìˆ˜í–‰ìœ¼ë¡œ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤.\
  [ì½”ë“œë ˆì´ JAR ì—°ê³„ê°€ì´ë“œ](./coderay-openapi-guide-jar/README.md)
